<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Passwortmanager ‚Äì Demo Frontend</title>
  <style>
    :root{
      --bg: #0b0f14;          /* page */
      --card: #11161d;        /* surfaces */
      --muted: #a9b1bb;       /* text secondary */
      --text: #e8edf2;        /* text primary */
      --brand: #5b9dff;       /* accents */
      --brand-2:#7ef0d4;      /* gradient */
      --danger:#ff6b6b;       /* destructive */
      --ok:   #62d392;        /* success */
      --warning:#ffc66b;      /* warn */
      --ring: rgba(91,157,255,.35);
      --input:#18202a;
      --border:#1b2430;
      --shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
      --radius:16px;
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f5f7fb; --card:#ffffff; --text:#0c141c; --muted:#506070; --input:#f0f3f8; --border:#e6ebf3; --shadow:0 10px 30px rgba(16,31,60,.08), inset 0 1px 0 rgba(255,255,255,.8); }
    }
    *{ box-sizing: border-box }
    html,body{ height:100% }
    body{ margin:0; font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, Noto Sans, "Apple Color Emoji","Segoe UI Emoji"; background: radial-gradient(1200px 600px at 10% -10%, rgba(94,160,255,.15), transparent 60%), radial-gradient(900px 500px at 120% 10%, rgba(126,240,212,.12), transparent 60%), var(--bg); color:var(--text); }
    .container{ max-width:1100px; margin-inline:auto; padding:28px; }

    /* Topbar */
    .topbar{ display:flex; align-items:center; justify-content:space-between; gap:18px; margin-bottom:24px; }
    .brand{ display:flex; align-items:center; gap:12px; font-weight:700; letter-spacing:.2px; }
    .logo{ width:36px; height:36px; border-radius:12px; background: linear-gradient(135deg, var(--brand), var(--brand-2)); box-shadow: var(--shadow); display:grid; place-items:center; color:white; font-weight:900; }
    .tabs{ display:flex; gap:8px; flex-wrap:wrap; }
    .tab{ padding:10px 14px; border-radius:12px; background:transparent; color:var(--muted); border:1px solid transparent; cursor:pointer; }
    .tab[data-active="true"]{ color:var(--text); background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,0)); border-color:var(--border); box-shadow: var(--shadow); }

    /* Layout */
    .grid{ display:grid; grid-template-columns: 1.5fr 1fr; gap:20px; }
    @media (max-width: 960px){ .grid{ grid-template-columns: 1fr; } }

    /* Cards */
    .card{ background: var(--card); border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow); overflow:hidden; }
    .card h3{ margin:0; padding:18px 18px 0; font-size:18px; }
    .card .sub{ color:var(--muted); font-size:14px; padding:4px 18px 12px; }
    .card .body{ padding:18px; display:grid; gap:12px; }

    /* Forms */
    .row{ display:grid; gap:8px; }
    label{ font-size:13px; color:var(--muted); }
    input, select{ background:var(--input); color:var(--text); border:1px solid var(--border); border-radius:12px; padding:12px 14px; outline:none; }
    input:focus{ border-color:transparent; box-shadow: 0 0 0 4px var(--ring); }
    .btn{ appearance:none; border:1px solid var(--border); background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0)); color:var(--text); padding:12px 16px; border-radius:14px; cursor:pointer; box-shadow: var(--shadow); display:inline-flex; align-items:center; gap:10px; justify-content:center; }
    .btn.primary{ background: linear-gradient(135deg, var(--brand), var(--brand-2)); border-color: transparent; color:#0b1020; font-weight:700; }
    .btn.ghost{ background:transparent; }
    .btn.warn{ background: linear-gradient(180deg, rgba(255,198,107,.2), rgba(255,198,107,.08)); color:#2b1a00; border-color:rgba(255,198,107,.4) }
    .btn.danger{ background: linear-gradient(180deg, rgba(255,107,107,.25), rgba(255,107,107,.08)); color:#330; border-color:rgba(255,107,107,.4) }
    .btn.small{ padding:8px 10px; border-radius:10px; font-size:13px; }

    .inline{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

    /* Table */
    table{ width:100%; border-collapse: collapse; }
    th, td{ text-align:left; padding:12px 10px; border-bottom:1px dashed var(--border); }
    th{ color:var(--muted); font-weight:600; font-size:13px; }

    /* Pills & helpers */
    .pill{ font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid var(--border); color:var(--muted); }
    .muted{ color:var(--muted) }
    .spacer{ height:8px }

    /* Modal */
    .modal-backdrop{ position: fixed; inset:0; background: rgba(7,12,20,.56); backdrop-filter: blur(10px); display:none; place-items:center; padding:22px; z-index:10; }
    .modal{ width:min(680px, 100%); background: var(--card); border:1px solid var(--border); border-radius: calc(var(--radius) + 4px); box-shadow: 0 25px 100px rgba(0,0,0,.45); overflow:hidden; }
    .modal header{ padding:16px 18px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid var(--border) }
    .modal .content{ padding:18px; display:grid; gap:12px; }

    .show{ display:grid }

    /* Toast */
    .toast{ position: fixed; right:18px; bottom:18px; background: var(--card); border:1px solid var(--border); padding:14px 16px; border-radius:12px; box-shadow: var(--shadow); display:none; }
    .toast.show{ display:block; }

    /* Sections visibility */
    .section{ display:none }
    .section[aria-current="page"]{ display:block }

    /* Slider wrapper */
    .slider-wrap{ display:grid; grid-template-columns: 1fr auto; align-items:center; gap:10px; }
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">
        <div class="logo">üîê</div>
        <div>
          <div>LockBox</div>
          <div class="muted" style="font-size:12px">Clientseitig verschl√ºsselt ¬∑ Demo-UI</div>
        </div>
      </div>
      <nav class="tabs">
        <button class="tab" data-route="login" data-active="true">Anmelden</button>
        <button class="tab" data-route="register">Registrieren</button>
        <button class="tab" data-route="home">Tresor</button>
        <button class="tab" data-route="settings">Einstellungen</button>
      </nav>
    </div>

    <!-- LOGIN / REGISTER PANELS -->
    <section class="section" id="view-login" aria-current="page">
      <div class="grid">
        <div class="card">
          <h3>Mit Master-Passwort anmelden</h3>
          <div class="sub">E-Mail + Master-Passwort. Danach 2. Faktor.</div>
          <div class="body">
            <div class="row"><label>E-Mail</label><input id="login-email" type="email" placeholder="you@example.com" /></div>
            <div class="row"><label>Master-Passwort</label><input id="login-pass" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" /></div>
            <div class="inline">
              <button class="btn primary" id="btn-login">Anmelden</button>
              <span class="pill">Status: <span id="login-status" class="muted">‚Äì</span></span>
            </div>
            <div class="muted" style="font-size:13px">Kein Konto? <button class="btn small ghost" data-route="register">Jetzt registrieren</button></div>
          </div>
        </div>
        <div class="card">
          <h3>2. Faktor erforderlich</h3>
          <div class="sub">Alexa-Freigabe oder TOTP/WebAuthn (Fallback)</div>
          <div class="body">
            <div class="inline">
              <button class="btn" id="btn-alexa">Alexa-Freigabe anfordern</button>
              <button class="btn" id="btn-fallback">Mit TOTP fortfahren</button>
            </div>
            <div class="row"><label>Countdown</label><progress id="tx-progress" value="0" max="90" style="width:100%"></progress></div>
            <div class="inline"><span class="pill">Tx-ID</span><code id="txid" class="muted">‚Äî</code></div>
          </div>
        </div>
      </div>
    </section>

    <section class="section" id="view-register">
      <div class="grid">
        <div class="card">
          <h3>Neues Konto anlegen</h3>
          <div class="sub">E-Mail und Master-Passwort festlegen</div>
          <div class="body">
            <div class="row"><label>E-Mail</label><input id="reg-email" type="email" placeholder="you@example.com" /></div>
            <div class="row"><label>Master-Passwort</label><input id="reg-pass" type="password" placeholder="Sicheres Passwort" /></div>
            <div class="inline">
              <button class="btn primary" id="btn-register">Registrieren</button>
              <span class="muted" id="reg-status">¬†</span>
            </div>
            <p class="muted" style="font-size:13px">Der Verschl√ºsselungs-Key wird aus dem Master-Passwort abgeleitet. Server sieht nie Klartext.</p>
          </div>
        </div>
        <div class="card">
          <h3>Hinweise zur Sicherheit</h3>
          <div class="body">
            <ul class="muted">
              <li>Alle Tresor-Eintr√§ge werden <b>clientseitig</b> verschl√ºsselt.</li>
              <li>Nutze einen Passwortgenerator und aktiviere 2FA.</li>
              <li>Bewahre Recovery-Codes sicher offline auf.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- HOME / VAULT -->
    <section class="section" id="view-home">
      <div class="card">
        <h3>Dein Tresor</h3>
        <div class="sub">Eintr√§ge filtern, anlegen und ansehen</div>
        <div class="body">
          <div class="inline">
            <input id="filter" placeholder="Suchen nach Website/Titel‚Ä¶" style="flex:1" />
            <button class="btn primary" id="btn-add">+ Neuer Eintrag</button>
          </div>
          <div class="spacer"></div>
          <table id="vault-table">
            <thead><tr><th>Website/Programm</th><th>Benutzername</th><th>Passwort</th><th style="width:130px">Aktionen</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SETTINGS / 2FA -->
    <section class="section" id="view-settings">
      <div class="grid">
        <div class="card">
          <h3>2. Faktor einrichten</h3>
          <div class="sub">Alexa oder Fallback (TOTP/WebAuthn)</div>
          <div class="body">
            <h4 class="muted" style="margin:0">Alexa</h4>
            <div class="inline">
              <button class="btn" id="btn-link-alexa">Alexa verkn√ºpfen</button>
              <span class="pill" id="alexa-state">nicht verkn√ºpft</span>
            </div>
            <div id="pairing" class="muted" style="display:none">Pairing-Code: <b id="pair-code">‚Äî</b> (5 min)</div>
            <hr style="border:none;border-bottom:1px dashed var(--border)">
            <h4 class="muted" style="margin:0">Fallback: TOTP</h4>
            <div class="inline">
              <button class="btn" id="btn-totp-setup">QR-Code anzeigen</button>
              <button class="btn" id="btn-totp-verify">Code verifizieren</button>
              <button class="btn warn" id="btn-recovery">Recovery-Codes neu generieren</button>
            </div>
            <div id="totp-box" class="muted" style="display:none">
              <div class="row"><label>otpauth:// URI</label><input id="otpauth" readonly value="" /></div>
              <div class="row"><label>QR-Code (Platzhalter)</label><div style="height:160px;border:1px dashed var(--border);border-radius:12px;display:grid;place-items:center">Wird serverseitig generiert</div></div>
            </div>
            <div id="recovery-list" class="muted"></div>
          </div>
        </div>
        <div class="card">
          <h3>Einstellungen</h3>
          <div class="body">
            <div class="row"><label>Voice-PIN (Alexa)</label><input id="voice-pin" maxlength="6" placeholder="4‚Äì6-stellig" /></div>
            <div class="inline">
              <button class="btn" id="btn-save-settings">Speichern</button>
              <span id="save-status" class="muted">¬†</span>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Add Entry Modal -->
  <div class="modal-backdrop" id="modal-add">
    <div class="modal">
      <header>
        <strong>Neuer Eintrag</strong>
        <div class="inline">
          <button class="btn small ghost" data-close="#modal-add">Schlie√üen</button>
          <button class="btn small primary" id="btn-save-entry">Speichern</button>
        </div>
      </header>
      <div class="content">
        <div class="row"><label>Website / Programm</label><input id="new-site" placeholder="z. B. github.com" /></div>
        <div class="row"><label>Benutzername / E-Mail</label><input id="new-user" placeholder="name@domain.tld" /></div>
        <div class="row">
          <label>Passwort</label>
          <div class="inline" style="width:100%">
            <input id="new-pass" style="flex:1" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
            <button class="btn small" id="btn-generate">Generieren</button>
            <button class="btn small" id="btn-copy-pass">Kopieren</button>
          </div>
          <details>
            <summary class="muted">Generator-Optionen</summary>
            <div class="row" style="margin-top:8px">
              <div class="slider-wrap"><label>L√§nge: <b id="len-out">20</b></label><input type="range" min="8" max="64" value="20" id="opt-length"/></div>
              <div class="inline">
                <label><input type="checkbox" id="o-lower" checked> Kleinbuchstaben</label>
                <label><input type="checkbox" id="o-upper" checked> Gro√übuchstaben</label>
                <label><input type="checkbox" id="o-digits" checked> Ziffern</label>
                <label><input type="checkbox" id="o-symbols" checked> Symbole</label>
              </div>
            </div>
          </details>
        </div>
      </div>
    </div>
  </div>

  <!-- Viewer Modal -->
  <div class="modal-backdrop" id="modal-view">
    <div class="modal">
      <header>
        <strong>Eintrag ansehen</strong>
        <div class="inline">
          <button class="btn small ghost" data-close="#modal-view">Schlie√üen</button>
        </div>
      </header>
      <div class="content" id="view-content"></div>
    </div>
  </div>

  <div class="toast" id="toast">Kopiert. Wird in 30s gel√∂scht‚Ä¶</div>

<script>
(function(){
  // --- Simple state (demo; kein Backend).
  const state = {
    route: 'login',
    entries: [],
    txId: null,
    txLeft: 0,
    alexaLinked: false,
    pairingCode: null,
    recovery: []
  };

  // --- Routing helpers
  const tabs = document.querySelectorAll('.tab');
  const sections = {
    login: document.getElementById('view-login'),
    register: document.getElementById('view-register'),
    home: document.getElementById('view-home'),
    settings: document.getElementById('view-settings')
  };
  function go(route){
    state.route = route;
    tabs.forEach(t=> t.dataset.active = (t.dataset.route===route));
    Object.entries(sections).forEach(([key,el])=> el.setAttribute('aria-current', key===route?'page':'false'));
  }
  document.addEventListener('click', (e)=>{
    const routeBtn = e.target.closest('[data-route]');
    if(routeBtn){ go(routeBtn.dataset.route); }
    const closeBtn = e.target.closest('[data-close]');
    if(closeBtn){ document.querySelector(closeBtn.dataset.close).classList.remove('show'); }
  });

  // --- Modal helpers
  const modalAdd = document.getElementById('modal-add');
  const modalView = document.getElementById('modal-view');
  document.getElementById('btn-add').onclick = ()=> modalAdd.classList.add('show');
  document.getElementById('btn-save-entry').onclick = saveEntry;

  // --- Register
  document.getElementById('btn-register').onclick = ()=>{
    const mail = document.getElementById('reg-email').value.trim();
    const pw = document.getElementById('reg-pass').value;
    const out = document.getElementById('reg-status');
    if(!mail || !pw){ out.textContent = 'Bitte E-Mail & Passwort.'; return; }
    out.textContent = 'Erfolgreich ‚Äì jetzt anmelden';
    go('login');
  };

  // --- Login + 2FA Flow (UI-Demo)
  const loginStatus = document.getElementById('login-status');
  document.getElementById('btn-login').onclick = ()=>{
    const mail = document.getElementById('login-email').value.trim();
    const pw = document.getElementById('login-pass').value;
    if(!mail || !pw){ loginStatus.textContent = 'Bitte E-Mail & Passwort'; return; }
    loginStatus.textContent = '2. Faktor erforderlich';
    // create tx id with 90s TTL
    state.txId = crypto.randomUUID();
    document.getElementById('txid').textContent = state.txId;
    state.txLeft = 90; updateProgress();
    go('login'); // stay on page, right column shows 2FA card
  };
  function updateProgress(){
    const p = document.getElementById('tx-progress');
    clearInterval(updateProgress._t);
    p.value = 0; let left = state.txLeft;
    updateProgress._t = setInterval(()=>{
      left--; p.value = 90-left; if(left<=0){ clearInterval(updateProgress._t); loginStatus.textContent='Transaktion abgelaufen'; }
    },1000);
  }
  document.getElementById('btn-alexa').onclick = ()=>{
    if(!state.alexaLinked){ alert('Alexa nicht verkn√ºpft. Bitte in Einstellungen verkn√ºpfen.'); return; }
    loginStatus.textContent = 'Freigabe erteilt'; go('home');
  };
  document.getElementById('btn-fallback').onclick = ()=>{
    const code = prompt('TOTP-Code (Demo)');
    if(code){ loginStatus.textContent = 'Freigabe erteilt'; go('home'); }
  };

  // --- Vault list rendering
  const tbody = document.querySelector('#vault-table tbody');
  const filter = document.getElementById('filter');
  filter.addEventListener('input', render);
  function render(){
    const q = filter.value.toLowerCase();
    tbody.innerHTML = '';
    state.entries.filter(e=> e.site.toLowerCase().includes(q) || e.user.toLowerCase().includes(q)).forEach(e=>{
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${e.site}</td><td>${e.user}</td><td><span class="pill">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span></td><td class="inline"><button class="btn small" data-view="${e.id}">Ansehen</button><button class="btn small danger" data-del="${e.id}">L√∂schen</button></td>`;
      tbody.appendChild(tr);
    });
  }
  tbody.addEventListener('click', (ev)=>{
    const view = ev.target.closest('[data-view]');
    const del  = ev.target.closest('[data-del]');
    if(view){ openViewer(view.dataset.view); }
    if(del){ state.entries = state.entries.filter(x=>x.id!==del.dataset.del); render(); }
  });

  // --- Add Entry
  const lenRange = document.getElementById('opt-length');
  const lenOut = document.getElementById('len-out');
  lenRange.oninput = ()=> lenOut.textContent = lenRange.value;
  document.getElementById('btn-generate').onclick = ()=>{
    document.getElementById('new-pass').value = generate({
      length: +lenRange.value,
      lower: document.getElementById('o-lower').checked,
      upper: document.getElementById('o-upper').checked,
      digits: document.getElementById('o-digits').checked,
      symbols: document.getElementById('o-symbols').checked,
    });
  };
  document.getElementById('btn-copy-pass').onclick = ()=> copyWithAutoClear(document.getElementById('new-pass').value);
  function saveEntry(){
    const site = document.getElementById('new-site').value.trim();
    const user = document.getElementById('new-user').value.trim();
    const pass = document.getElementById('new-pass').value;
    if(!site || !user || !pass){ alert('Bitte alle Felder ausf√ºllen'); return; }
    state.entries.unshift({ id: crypto.randomUUID(), site, user, pass });
    modalAdd.classList.remove('show');
    document.getElementById('new-site').value='';
    document.getElementById('new-user').value='';
    document.getElementById('new-pass').value='';
    render();
  }

  // --- Viewer
  function openViewer(id){
    const e = state.entries.find(x=>x.id===id); if(!e) return;
    const box = document.getElementById('view-content');
    box.innerHTML = ''+
     `<div class="row"><label>Website</label><input readonly value="${e.site}"></div>`+
     `<div class="row"><label>Benutzername</label><input readonly value="${e.user}"></div>`+
     `<div class="row"><label>Passwort</label><div class="inline"><input id="view-pass" readonly value="${e.pass}" style="flex:1"><button class="btn small" id="btn-v-copy">Kopieren</button></div></div>`+
     `<div class="muted" style="font-size:13px">Kopierte Passw√∂rter werden nach 30 Sekunden aus der Zwischenablage gel√∂scht.</div>`;
    modalView.classList.add('show');
    setTimeout(()=>{ const b=document.getElementById('btn-v-copy'); if(b){ b.onclick=()=> copyWithAutoClear(e.pass); } }, 0);
  }

  // --- Alexa Link + TOTP placeholders
  document.getElementById('btn-link-alexa').onclick = ()=>{
    state.alexaLinked = !state.alexaLinked;
    document.getElementById('alexa-state').textContent = state.alexaLinked? 'verkn√ºpft ‚úì' : 'nicht verkn√ºpft';
    if(state.alexaLinked){
      state.pairingCode = (''+Math.floor(100000+Math.random()*900000));
      document.getElementById('pair-code').textContent = state.pairingCode;
      document.getElementById('pairing').style.display='block';
    } else {
      document.getElementById('pairing').style.display='none';
    }
  };
  document.getElementById('btn-totp-setup').onclick = ()=>{
    const uri = 'otpauth://totp/LockBox:you%40example.com?secret=JBSWY3DPEHPK3PXP&issuer=LockBox&period=30&digits=6&algorithm=SHA1';
    document.getElementById('otpauth').value = uri;
    document.getElementById('totp-box').style.display='block';
  };
  document.getElementById('btn-totp-verify').onclick = ()=> alert('Verifizierung (Demo) erfolgreich');
  document.getElementById('btn-recovery').onclick = ()=>{
    state.recovery = Array.from({length:10}, ()=> Math.random().toString(36).slice(2,8).toUpperCase());
    document.getElementById('recovery-list').innerHTML = '<div class="pill">Recovery‚ÄëCodes</div><pre style="margin:8px 0;white-space:pre-wrap">'+state.recovery.join('\n')+'</pre>';
  };
  document.getElementById('btn-save-settings').onclick = ()=>{
    document.getElementById('save-status').textContent = 'Gespeichert';
    setTimeout(()=> document.getElementById('save-status').textContent='¬†', 1500);
  };

  // --- Password generator + clipboard helpers
  function generate({length=20, lower=true, upper=true, digits=true, symbols=true}){
    const sets = {
      lower: 'abcdefghijklmnopqrstuvwxyz',
      upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
      digits:'0123456789',
      symbols:'!@#$%^&*()-_=+[]{};:,.?/'
    };
    let pool = '';
    if(lower) pool+=sets.lower; if(upper) pool+=sets.upper; if(digits) pool+=sets.digits; if(symbols) pool+=sets.symbols;
    if(!pool) pool = sets.lower;
    const arr = new Uint32Array(length); crypto.getRandomValues(arr);
    return Array.from(arr, n=> pool[n % pool.length]).join('');
  }
  function copyWithAutoClear(text){
    if(!text){ return; }
    navigator.clipboard.writeText(text).then(()=>{
      const toast = document.getElementById('toast');
      toast.classList.add('show');
      setTimeout(()=> toast.classList.remove('show'), 2000);
      const t = setTimeout(()=>{ navigator.clipboard.writeText(''); clearTimeout(t); }, 30000);
    }).catch(()=> alert('Kopieren nicht erlaubt'));
  }

  // Start view
  render();
})();
</script>
</body>
</html>
